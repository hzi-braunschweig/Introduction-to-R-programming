---
title: "R Notebook"
output: html_notebook
---

# Final exercise

Welcome to the final day of the **Introduction to R** course. As a final exercise and a first own project (with a little guidance and support by us) we want to work with the data set about 18800 video games. You don't need any knowledge in this area, we will just use it as good example.

## Package and Data import

Before we start we need to load some packages. Please use the following code block to load `tidyr` and `ggplot2`. If these packages are not installed do so.

```{r}
library(tidyverse)
library(ggplot2)
```

In the next step we want to import the data set from the file `video_games.csv`. Use `read.csv()` and the correct path to load it and save it as `raw_data`.

```{r}
raw_data <- read.csv("data/video_games.csv")
```

## Exploring the data

Use `str()` to get an idea of the columns of `raw_data`.

```{r}
str(raw_data)
```

*Are there some things that seem problematic or unuseful for us? List them in the following lines.*

-   Leading white spaces in `platform`.

-   Undesirable date format in `release_date`.

-   Unneeded information in `summary`.

-   Ratings `user_review` seem to be `numeric`, but are `chr`.

```{r}
head(raw_data)
```

## Data cleaning

We want to proceed with cleaning our data and solving the issues we found.

### `summary`

The column `summary` might include interesting things, but is of no need for us. Therefore we don't want to carry it all the way. Use the next code block, to drop that column and safe the new data frame as `data`.

```{r}
data <- raw_data[,-c(4)]
```

### `release_date`

If we have a look in the column `release_date`, we notice that the dates have a undesirable format. We just want the information about the year and just in case keep the first part as well. Fill the gaps in the following code to separate the dates in `release_date` into a "month_day" and "year" part. What separator `sep` is used in the initial column? If you have questions about the function `separate()` first use the build-in help.

```{r}
data <- separate(data = data, col = release_date, into = c("month_day", "year"), sep = ", ")
```

After the separating `year` from `month_day` we end with `chr` as entries. Use the next code block to change the entries of `year` to `numeric`.

```{r}
data$year <- as.numeric(data$year)
```

### `user_review`

Looking into the column `user_review` we see that the entries are `chr`. Since these are basically numbers use the next block to change their data type to something better suitable. You might get a warning, that some entries are converted to `NA`, that is not a problem.

```{r}
data$user_review <- as.numeric(data$user_review)
```

### `platform`

Maybe you have not spotted the issue with the entries in `platform`. Use a function to have a look at the first (six) entries of that column.

```{r}
head(data$platform)
```

The entries all have a leading white space that is not very aesthetic and might cause problems later. Therefore apply `trimws()` to the column and assign the result to the old column.

```{r}
data$platform <-  trimws(data$platform)
```

### Simplifying the data

In our data set we distinguish between the same game released on different platforms. If we are more interested in the game this might not be reasonable. Use the next block to calculate the fraction of unique games to the total number of rows.

```{r}
length(unique(data$name))/length(data$name)
```

The next line use some technique we have not discussed and creates the new data frame `unique_games`. Are you able do understand the code? Execute the block and try to fill the following list.

```{r}
unique_games <- data |> group_by(name) |> 
  mutate(score_min = min(user_review)) |> 
  mutate(score_mean = mean(user_review)) |>
  mutate(score_max = max(user_review)) |>
  mutate(year = min(year)) |> 
  select(c(name, year, score_min, score_mean, score_max)) |> 
  distinct() |> ungroup()
```

-   `name`: The name of a unique game

-   `score_min`: The minimum user review the game received over all platforms

-   `score_mean`: The mean user review the game received over all platforms

-   `score_max`: The maximum user review the game received over all platforms

-   `year_med`: The median of the release year over all platforms

## Data Visualization

In this section we create some visualizations to better understand and present the data.

### Games per platform

First we are interested in the games released on different platforms the games in our data sets were released on. Create a table listing the games released on each console (the notebook might shift the output, for a better view have a look in the console.). *What is the platform with the most released games?*

```{r}
table(data$platform)
```

For a better and quicker overview we want to create a graphic to visualize the same information.Use the following code block to create such a graphic.

```{r}
barplot(table(data$platform), las = 2)
```

```{r}
ggplot(data = data, aes(x = platform)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90))
```

### Games per year

We are now interested in the released games per year. Use the following code chunk to create a table listing how many games were released in each year. Use the data frame `unique_games` for this, since this data sets only lists every game once.

```{r}
table(unique_games$year)
```

As before create a graphic to visualize this the same information.

```{r}
barplot(table(unique_games$year))
```

```{r}
ggplot(data = unique_games, aes(x = year)) +
  geom_bar()
```

### Review distribution

The next interesting part is the information about the user reviews. Think about a good way to present the distribution of user reviews and use the next block to create a graphic. *You are free to decide if you want to use `data` or `unique_games`*.

```{r}
hist(data$user_review)

ggplot(data = data, aes(x = user_review)) +
  geom_histogram(breaks = seq(0,10,1), na.rm = TRUE)
```

```{r}
hist(unique_games$score_mean)

ggplot(data = unique_games, aes(x = score_mean)) +
  geom_histogram(breaks = seq(0,10,1), na.rm = TRUE)
```

How is the user review developing with time? Use the following code block to visualize the distribution of the different years. *Can you spot a trend?*

```{r}
boxplot(user_review ~ year, data = data)

ggplot(data = data, aes(x = as.factor(year), y = user_review)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90))
```

```{r}
boxplot(score_mean ~ year, data = unique_games)

ggplot(data = unique_games, aes(x = as.factor(year), y = score_mean)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 90))
```

## Linear Regression

```{r}
data$years_since_1995 = data$year - 1995
summary(lm(user_review ~ years_since_1995, data = data))
```

## Questions

*What is the game with the highest* `user_review` *from the year 2015?*

```{r}
data_ordered <- data[order(data$user_review, decreasing = TRUE),]
data_ordered[data_ordered$year == 2015,][1, "name"]
```
