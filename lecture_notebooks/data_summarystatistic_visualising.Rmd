---
title: ' Summary statistics and visualisations'
author: "Bernard Silenou and Henrik Schanze"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    theme: united
editor_options: 
  markdown: 
    wrap: 72
---

-   After imparting and cleaning your data, the next aim before
    modelling is to understand your data.
-   Essential tools to attain this aim are *summary statistics* and
    *plots*.

## Goals

-   Be able to calculate a range of summary statistics on numeric data
-   Be able to draw plots and export out of R

# Summary statistics

-   Summary statistics are used to summarize a data in order to
    communicate the largest amount of information as simply as possible.

-   Measures often used are arithmetic mean, variance or standard
    deviation, and correlation coefficient.

-   The *obama_vs_mccain* dataset contains the fractions of people
    voting for Obama and McCain in the 2008 US presidential elections.

-   We load this data from the R package *learningr* and use it in
    subsequent examples:

```{r}
#data(package = "learningr") # to print the names of dataset in the package learningr
#data(obama_vs_mccain, package = "learningr")
load(file ="data/obama_vs_mccain.rda")
votesObama = obama_vs_mccain$Obama
```

Let {x} be the votes for Obama.

### Measure of location:

`mean(x)`: sum of x divided by the length

```{r}
mean(votesObama)
```

`median(x)`: 50% of x is above and 50% is below

```{r}
median(votesObama)
```

### Measure of rank:

`min(x)`: minimum value of x

```{r}
min(votesObama)
```

`max(x)`: maximum value of x

```{r}
max(votesObama)
```

`quantile(x, 0.25)`: 25% of x is below this value; `quantile(x, 0.50)`==
median(x)

```{r}
quantile(votesObama, 0.50)
median(votesObama)
quantile(votesObama)
```

### Measure of variation:

`sd(x)`: standard deviation, square sd to get variance or use `var(x)`

```{r}
sd(votesObama)
var(votesObama) 
sd(votesObama)**2
```

`range(x)`: gives min and max values

```{r}
range(votesObama)
```

`IQR(x)`: interquartile range == 75th percentile minus 25th percentile

```{r}
IQR(votesObama)
```

### Measure of position or count:

`x[1]`: first element in x

```{r}
votesObama[1]
```

`x[length(x)]`: last element in x

```{r}
votesObama[length(votesObama)]
```

**Quick exercise**: what is the last last but one element in
`votsObama`?

### Other summary statistics functions:

`summary(x)`: generic function to compute multiple statistics at once

```{r}
summary(votesObama)
summary(obama_vs_mccain)
```

`length(x)`: the number of element in x

```{r}
length(votesObama)
dim(obama_vs_mccain)
dim(obama_vs_mccain)[1] # the same as nrow(obama_vs_mccain)
dim(obama_vs_mccain)[2] # the same as ncol(obama_vs_mccain)
```

`table(is.na(x))`: count the number of missing and non missing values

```{r}
table(is.na(votesObama))
```

`length(unique(x))`: count the number of unique value

```{r}
length(unique(obama_vs_mccain$Region))
```

`cor(x)`: calculates correlations between numeric vectors, "pearson"
(default)

```{r}
cor(obama_vs_mccain$Obama, obama_vs_mccain$McCain)
```

`cov(x)`: calculates covariance between numeric vectors, "pearson"
(default)

```{r}
with(obama_vs_mccain, cov(Obama, McCain)) # the same as cov(obama_vs_mccain$Obama, obama_vs_mccain$McCain)
```

# Visulisations

## Systems of plots

R has three systems of graphics: *base*, *grid*, and *lattice*.

**Base graphics** is easy to get started with but hard to extend to new
graph types. It will be used for a greater part of this section.

**Grid graphics** provides greater flexibility but require writing much
lines of code. Example is package ggplot2--most modern and widely used.

**Lattice graphics** is built on top of the grid system, providing
high-level functions for all the common plot types. Plot output can be
saved as objects, edited and later plotted.

The three systems are, sadly, mostly incompatible, thus recommended to
choose one system for a project. ggplot2 is a good choice.

## Heat maps

When we want to visualize the connection of two categorical variables
our set of tools is quite limited. As an example we have a look at the
data set `mtcars` incorporating data about 32 cars. We want to visualize
the (possible) link between the number of cylinders `cyl` and number of
(forward) gears `gear`.

One of the most simple solutions is to use a cross table. To create one,
we can use `table()` and hand over the column names we are interested in
(you can hand in more than two, but the cases that this is useful are
quite limited).

```{r}
table(mtcars$cyl, mtcars$gear)
```

Depending on the number of categories and magnitude of numbers, spotting
an underlying correlation might be quite hard. A way to spot connections
faster is to color-code the cells of the cross table, that is what a
heat map does.

### Using base R

To transform across table into heat map we can give the cross table to
`heatmap()`.

```{r}
heatmap(table(mtcars$cyl, mtcars$gear))
```

Without any further arguments `heatmap()` also creates a dendrogram an
reorders the categories according to the clustering. To deactivate that
we have to set the arguments `Rowv` and `Colv` to `NA` and by setting
`revC=TRUE` we get the same cell order than in the cross table.

```{r}
heatmap(table(mtcars$cyl, mtcars$gear), Rowv = NA, Colv = NA, revC = TRUE,
        main = "Number of cylinders vs. number of gears",
        xlab = "Number of gears",
        ylab = "Number of cylinders")
```

### Using ggplot2 package

First of all we have to load the `ggplot2` package.

```{r}
library(ggplot2)
```

Creating a heat map with `ggplot2` requires a little bit extra work, but
it enables us to adjust the graphic in more detail. We also start with
the initial cross table, but turn it into a data frame

```{r}
df_cars <- data.frame(table(mtcars$cyl, mtcars$gear))

df_cars
```

Now we can hand over that data frame to `ggplot()` and specify in
`aes()` which variable (from the data frame) should be on the `x` axis,
on the `y` axis and which numbers should the cells be filled with
(`fill`). Finally we can add title and labels as before.

```{r}
ggplot(df_cars, aes(x = Var2, y = Var1, fill = Freq)) +
  geom_tile() +
  labs(main = "Number of cylinders vs. number of gears",
       x = "Number of gears",
       y = "Number of cylinders")
```

## Scatter plot

It is used to explore the relationship between two continuous variables

### Using base R

Example: Does voters *Income* affect *Turnout* at the polls?

`plot(x)` to plot scatter plot. NA are omitted by default.

```{r}
# Deleting NA
obama_vs_mccain_turnout_non_na = obama_vs_mccain[!is.na(obama_vs_mccain$Turnout), ]
# plotting scatter plot
plot(obama_vs_mccain_turnout_non_na$Income, obama_vs_mccain_turnout_non_na$Turnout)
# or using with command
with(obama_vs_mccain_turnout_non_na, plot(Income, Turnout))
```

We can edit the plot by using various parameters as described in the
help document `? plot` or `?? plot`

```{r}
with(obama_vs_mccain_turnout_non_na, plot(Income, Turnout, type = "p", main = "Scatter plot of Turnout versus Incoms",
                                          sub= "Obaba Vs McCain", xlab = "varage income", ylab = "Turnout percentage",
                                          col = "red", pch = 19, cex = 1.5 ))
```

Positive correlation between income and turnout

### Using ggplot2 package

Example: Does voters *Income* affect *Turnout* at the polls?

`ggplot()` to construct a plot. It takes a *dataframe* as its first
argument and an *aesthetic* as its second.

`geom_...()` to add e.g. points/line on the plot

```{r}
library(ggplot2)
gg1 = ggplot(obama_vs_mccain_turnout_non_na, aes(Income, Turnout, colour = Region)) + # colour points by region
geom_point(shape = 20)
print(gg1)
```

To draw individual plots for each region, we add a *facet* using the
function `facet_wrap`.

```{r}
gg2 = gg1 + 
  facet_wrap(~ Region, ncol = 5) +
  theme(axis.text.x = element_text(angle = 30, hjust = 1))   # to rotate x axis
plot(gg2)
  
```

## Line plot

It is often used to explore how a continuous variable changes over time.
It provides information about trend.

**Data:** we will use the crab data **crab_tag** in this section.

```{r}
# Extracting data from package
#data(crab_tag, package = "learningr")
load(file = "data/crab_tag.rda")
crab_tag_daylog = crab_tag$daylog 
str(crab_tag_daylog)
```

### Using base R

**Example**: Draw a line plot of max depth against date

`plot(x)` to plot line plot, just as scatter plot but with the option
`type = "l"`. The `plot()` function can be used to plot many other types
of plot.

```{r}
# Drawing line plot
with(
crab_tag_daylog,
plot(Date, Max.Depth, type = "l")
)
```

Inverting the y axis and assigning limits to make it look nice

```{r}
with(
crab_tag_daylog,
plot(Date, -Max.Depth, type = "l", ylim = c(-max(Max.Depth)-10, 10)) 
)
```

Example: Draw a line plot for max and min depth against date on the same
figure using different colours.

`lines()` To draw additional lines on an existing plot. The equivalent
for scatterplot is `points()`.

```{r}
with(
crab_tag_daylog,
plot(Date, -Max.Depth, type = "l", ylim = c(-max(Max.Depth)-10, 10)) 
)
# Adding the lines for min depth on the existing plot of max depth
with(
crab_tag$daylog,
lines(Date, -Min.Depth, col = "blue")
)
```

**Quick Exercise**: On the scatter plot of turnout Vs income plotted in
previous section, increase the income by 300 and plot the new scatter
plot on the existing plot. Use different colours.

### Using ggplot2 package

**Example**: Draw a line plot of max depth against date

Swapping a scatter plot for a line plot is as simple as swapping
`geom_point` for `geom_line`

```{r}
ggplot(crab_tag_daylog, aes(Date)) +
geom_line(aes(y = -Max.Depth), colour = "#a83b48") + # google "colour picker" to get the codes
geom_line(aes(y = -Min.Depth), colour = "darkgrey")
```

## Box plot

A box plot is a visualization of the distribution of numerical data.
Will we use the data set `mtcars` which incorporates fuel consumption
and ten aspects design and performance for 32 different cars. First we
have a short look into our data.

```{r}
head(mtcars)
```

Since this data set is part of base **R**, we can use the R help to get
a better understanding what the columns mean.

```{r}
?mtcars
```

Lets say we are interested in the distribution of the fuel consumption
`mpg` of the different cars. As we have seen before we can use the
`summary` function to get a (numerical) overview about the distribution
of the data.

```{r}
summary(mtcars$mpg)
```

That may answer some of our question regarding the over all fuel
consumption of the cars in the data set, but it es not very easy to gasp
and gets very overwhelming if we want to compare different distributions
of fuel consumption (e.g. distinguished by number of cylinders).

### Using base R

Using a box plot for visualizing puts all the above information in one
graphic.

```{r}
boxplot(mtcars$mpg)
```

Since the single plot includes all the information from before it needs
some information to be understood completely.

-   The Median is marked by the thick black line inside the grey box.

-   The 1st and 3rd quartile are the lower and upper end of the grey
    box, therefore $50\%$ of the values, including the median, are
    located inside the grey box.

-   The two antennas/whiskers give the range including (roughly) $95\%$
    of the data points.

-   Values outside this range are sometimes depicted as singular data
    points.

We can also use box plots to quickly compare the distribution of the
fuel consumption for different number of cylinders `cyl` or number of
gears `gear`.

To do that we have to give `boxplot` a so called formula describing the
relation we are interested in. A formula connects the (numeric) variable
we are interested in (e.g. `mgp`) via `~` with the grouping variables,
such as `cyl` or `gear`, usually a factor.

```{r}
boxplot(mpg ~ cyl, data = mtcars)
boxplot(mpg ~ gear, data = mtcars)
boxplot(mpg ~ cyl + gear, data = mtcars)
```

As before with other plots we have some basic options to manipulate the
appearance of the plots, e.g. add labels.

```{r}
boxplot(mtcars$mpg,
        main="Boxplot von mpg gruppiert nach cyl",
        xlab="Zylinder (cyl)", ylab="Miles per Gallon (mpg)")
```

We can also manually adjust the names of the groupes

```{r}
boxplot(mpg ~ vs, data = mtcars, names  = c("V-shaped", "Straight"))
```

### Using ggplot2 package

Again for further and more specific adjustment we could use `ggplot2`
instead of base **R**.

```{r}
library(ggplot2)
```

As with nearly every plot done with `ggplot` we start with making
`ggplot` familiar with the data we are using and which parts we want to
visualize. As before we want to use the data set `mtcars` and display
the fuel consumption `mpg`. We want to display the box plot vertically
we assign the variable `mpg` to the y-axis.

```{r}
ggplot(mtcars, aes(y = mpg)) + 
  geom_boxplot() + 
  labs(title = "Boxplot fuel consumption",
       y = "Miles per Gallon (mpg)")
```

When we want to plot box plot the data grouped in the different numbers
of cylinders `cyl` we have to make sure that the variable we use to
group the data is a factor. We can achieve this by using `as.factor()`.

```{r}
ggplot(mtcars, aes(x = as.factor(cyl), y = mpg)) +
  geom_boxplot() +
  labs(title = "Boxplot fuel consumption",
       x = "Number of cylinder (cyl)",
       y = "Miles per Gallon (mpg)")
```

## Histogram

Histograms are a very basic way to display a approximation of the
distribution of a given variable. In this example we want visualize the
data in `airquality` that include measurements on New York from May to
September 1973.

First we have a short look into the data.

```{r}
head(airquality)
```

In the following we want to visualize the distributions of wind speed
(measured in miles per hour). To get a first impression of the range of
that variable we use `summary()`.

```{r}
summary(airquality$Wind)
```

### Using base R

We want to use histograms to get a visual impression of the recorded
wind speeds. A histogram uses bins to collect ranges of data and depicts
the number of data points in each bin by its height. In base **R** we
can easily create such a plot by using `hist()`. Without additional
arguments **R** will distribute the 'bins' on its own, but we can also
manually adjust the number or width of the used 'bins' by the argument
`breaks`.

```{r}
hist(airquality$Wind,
     xlab = "Wind speed")

hist(airquality$Wind, breaks = 25,#c(0,seq(5,15,2), 21),
     xlab = "Wind speed")
```

Since it would be interesting to compare the distribution of wind speeds
for different months, we want to directly compare two histograms with
each other.

```{r}
hist(airquality[airquality$Month == 5,]$Wind,
     breaks = c(0,seq(5,15,2), 21), col = rgb(1,0,0,0.5),
     xlab = "Wind speed", main = "")

hist(airquality[airquality$Month == 8,]$Wind,
     breaks = c(0,seq(5,15,2), 21), col = rgb(0,0,1,0.5),
     add = TRUE)
```

### Using ggplot2 package

We want to show the way histograms could be created with `ggplot2`. In
case you have not loaded `ggplot2` please execute the following line.

```{r}
library(ggplot2)
```

As always with `ggplot2` we first have to tell what data we are using by
`ggplot()` and specifying what variable we are interested in. Afterwards
we can create the histogram with `geom_histogram()`. As before not
giving any information about the wanted bins leads to `ggplot` deciding
how to distribute the bins according to the data. We can either choose
the number of bins by `bins`, the width of the bins by `binwidth` or
specify where to separate between bins with `breaks`. Each of these
arguments overwrites the use of the former.

```{r}
ggplot(airquality, aes(x = Wind)) +
  geom_histogram()

ggplot(airquality, aes(x = Wind)) +
  geom_histogram(breaks = c(0,seq(5,15,2), 21))
```

We can also use `ggplot2` compare two (or more) histograms with each
other. In contrast to base R we do this in one single command using
`Month` as a factor (notice that we have selected the data for only two
different months in the first argument).

```{r}
ggplot(airquality[airquality$Month %in% c(5,8),],
       aes(x = Wind, fill = as.factor(Month))) +
  geom_histogram(position="identity", alpha=0.5, breaks=c(0,seq(5,15,2), 21)) +
  scale_fill_manual(values = c(rgb(1,0,0,0.5), rgb(0,0,1,0.5)))
```

## Bar chart

A bar chart displays the amount of of a discrete categorical data via
the height or length of a bar. Using a bar chart is therefore a visual
alternative for using a table.

As an example we will use the data set `mtcars` which includes
information about 32 different cars, e.g. the number of cylinders `cyl`,
the number of forward gears `gear`, the kind of transmission am (0 =
automatic, 1 = manual) and the engine design `vs` (0 = V-shaped, 1 =
straight).

```{r}
mtcars
```

```{r}
table(mtcars$cyl)
table(mtcars$gear)
table(mtcars$am)
table(mtcars$vs)
```

### Using base R

As we can see the data set `mtcars` lists different cars in their rows
including information about the number of cylinders `cyl`. To create a
bar chart depicting the number of cars with a certain amount of
cylinders, we can not use this data set directly, since this information
is not directly part of the data set.

To create such a bar chart we first have to extract the required
information out of the data set. Luckily `table()` does exactly what we
want. If we use it and turn the result via `data.frame()` into a data
frame (so we have access to the row listing the counts), we can use
`barplot()` to create the respective bar chart.

```{r}
cyl_table <- data.frame(table(mtcars$cyl))
cyl_table
barplot(height = cyl_table$Freq, names = cyl_table$Var1,
        main = "Amount of cars with respective number of cylinders",
        xlab = "Number of cylinders")
```

### Using ggplot2 package

If not already done, please load the `ggplot2` package.

```{r}
library(ggplot2)
```

Using `ggplot2` has the advantage that we can feed our data directly to
the 'plotting'-function without count the values of which amount we are
interested in 'manually'. We can give our data set to `ggplot()`, and
specify in `aes()` that we are interested to plot `cyl` a long the
x-axis. Since the numbers in `cyl` represent categories and not
(directly) numbers, we have to use `as.factor()`. After this initial
step, we could create the bar chart with adding `geom_bar()`,where we
can specify details about the bar chart, and `labs()` to set all kinds
of labels for our graphic.

```{r}
ggplot(mtcars, aes(x = as.factor(cyl))) +
  geom_bar() +
  labs(title = "Amount of cars with respective number of cylinders",
       x = "Number of cylinders",
       y = "Number of cars")
```

## Additional visulisations using gglot2 package

-   [ggplot2 references for further
    reading](https://r4ds.hadley.nz/data-visualize)
-   [ggplot2 references
    manual](https://cloud.r-project.org/web/packages/ggplot2/ggplot2.pdf)

# Getting help

-   [Posit Community, formally known as RStudio
    community](https://community.rstudio.com/)

-   [Stack Overflow link for
    ggplot](https://stackoverflow.com/questions/tagged/ggplot2?sort=frequent&pageSize=50)

-   [ggplot2 GitHub](https://github.com/tidyverse/ggplot2)

-   [ggplot2 references for further
    reading](https://r4ds.hadley.nz/data-visualize)
